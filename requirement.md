# 多终端在线管理系统需求文档

## 一、整体目标

构建一个支持多个 APP 终端加入/退出的系统：
- 终端会上报设备与位置信息
- 服务端基于 Gitee 代码片段（Gist）作为存储
- 前端可实时查看在线终端列表及地图分布

## 二、系统角色划分

### 1. 终端 APP（Android / iOS / 桌面等）

**职责：**
- 采集设备与位置信息
- 上报在线 / 离线状态
- 定期（或事件触发）更新数据

### 2. 数据存储（Gitee 代码片段）

**职责：**
- 作为轻量级"后端数据库"
- 存储所有终端的最新状态与信息

### 3. 管理/展示端（Web 或管理 APP）

**职责：**
- 查询 Gitee 代码片段
- 展示在线终端列表
- 地图可视化在线终端位置

## 三、核心功能需求拆解

### 1. 终端信息上报（Join / Heartbeat / Exit）

#### 1.1 上报的设备信息字段

```json
{
  "terminal_id": "唯一ID（UUID / 设备ID）",
  "terminal_name": "终端名称",
  "app_id": "APP标识",
  "platform": "Android / iOS / Windows / macOS",
  "device_model": "手机型号",
  "cpu": "CPU信息",
  "memory": "内存大小",
  "gps": {
    "lat": 39.9042,
    "lng": 116.4074
  },
  "status": "online / offline",
  "last_update": "2026-01-27T10:30:00Z"
}
```

### 2. Join（加入）功能

**触发时机：**
- APP 启动
- 用户点击"加入"

**行为：**
- 采集完整设备信息
- 设置 status = online
- 写入 / 更新 Gitee 代码片段中对应终端数据

### 3. Exit（退出）功能

**触发时机：**
- 用户点击"退出"
- APP 正常关闭（可选）

**行为：**
- 只更新状态 status = "offline"
- 更新时间 last_update

**可选增强：**
- 若 APP 异常退出，可依赖心跳超时自动判定离线

### 4. 心跳机制（强烈建议）

**目的：**
- 防止"假在线"
- 自动清理异常掉线终端

**规则建议：**
- 每 30s / 60s 上报一次
- 仅更新：GPS、last_update、status = online
- 离线判断：超过 N 分钟未更新 → 视为离线

## 四、Gitee 代码片段存储方案

### 1. 存储形式

单个代码片段，一个 JSON 文件：

```json
{
  "terminals": {
    "terminal_id_1": { ... },
    "terminal_id_2": { ... }
  }
}
```

### 2. 操作方式

- **读取：** GET 查询代码片段内容
- **更新：** PUT 覆盖整个 JSON（需先拉取再合并）

**注意事项：**
- 需要 Gitee Access Token
- 要考虑并发更新（可先简单实现，后续优化）

## 五、在线终端列表展示

**功能点：**

1. 从 Gitee 拉取最新 JSON

2. 过滤条件：
   - status == online
   - last_update 在有效时间内

3. 列表字段展示：
   - 终端名称
   - 平台
   - 设备型号
   - CPU / 内存
   - 最近更新时间
   - 在线状态

## 六、地图可视化需求

### 1. 地图能力

- 使用高德 / 百度 / Google Maps / Mapbox
- 展示在线终端位置 Marker

### 2. 展示规则

- 仅显示 status = online
- Marker 点击显示：
  - 终端名称
  - 设备型号
  - 最近更新时间

### 3. 自动刷新

- 每 N 秒重新拉取 Gitee 数据
- 动态更新 Marker

## 七、异常 & 边界情况

| 场景 | 处理方案 |
|------|----------|
| 同一 terminal_id 重复 Join | 覆盖更新 |
| GPS 不可用 | 允许为空，不上图 |
| Gitee API 失败 | 本地缓存 + 重试 |
| 并发写冲突 | 最后写入覆盖（可接受） |

## 八、任务总结

实现一个多终端在线管理系统：
- 多个 APP 终端可加入与退出，加入时上报设备与 GPS 信息，退出时更新离线状态
- 所有终端数据存储在 Gitee 代码片段中（JSON 格式）
- 前端可查询代码片段，展示在线终端列表，并在地图上显示所有在线终端的位置