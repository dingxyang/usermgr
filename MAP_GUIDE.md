# 地图功能使用指南

## 已完成的优化

已将地图从 OpenStreetMap（灰色瓦片问题）切换到**高德地图 JS API**，提供以下改进：

### ✅ 优化内容

1. **流畅交互** - 使用动态地图，支持缩放、拖动、旋转等丰富交互
2. **更好的中文支持** - 地图标注和地名全中文显示
3. **更准确的数据** - 中国地区地图数据更精确
4. **3D 地图视角** - 支持 3D 俯视模式，更直观
5. **智能标记** - 点击标记弹出详细信息窗口（平台、型号、CPU、内存、位置、更新时间）
6. **智能视野调整** - 自动调整地图视角以包含所有终端
7. **地图工具** - 内置比例尺和工具条，提供更好的操作体验
8. **国内访问稳定** - 高德服务器在国内，访问速度快且稳定

## 如何使用

### 0. 安装依赖

在项目根目录运行：

```bash
npm install @amap/amap-jsapi-loader
```

### 1. 申请高德地图 API Key（免费）

访问 [高德开放平台](https://console.amap.com/dev/key/app) 并按照以下步骤操作：

1. 注册/登录高德开放平台账号
2. 进入"应用管理" -> "我的应用"
3. 创建新应用（如果还没有）
4. 添加新 Key，选择 **"Web 端（JS API）"** 平台
5. 复制生成的 Key
6. （可选）如需提高安全性，可以申请安全密钥（securityJsCode）

> 💡 **提示**：Web 端 JS API 个人开发者每日配额为 30 万次，一般应用足够使用。

### 2. 配置 API Key

1. 在应用中点击顶部的 **"设置"** 标签
2. 找到 **"地图配置"** 卡片
3. 将申请到的 API Key 粘贴到 **"高德地图 API Key"** 输入框
4. （可选）如果需要使用安全密钥，将其粘贴到 **"安全密钥"** 输入框
5. 切换回 **"终端"** 标签

### 3. 查看地图

- 地图会自动显示所有**在线且有 GPS 数据**的终端
- 每个终端在地图上显示为红色标记点
- **点击标记**查看终端详细信息（平台、型号、CPU、内存、位置、更新时间）
- 可以**拖动地图**、**滚轮缩放**、**双指缩放**（移动端）
- 如果有多个终端，地图会自动调整视角显示所有终端

## 功能特点

- **流畅交互**：支持地图拖动、缩放、旋转等操作
- **自动更新**：地图会随着终端数据自动更新标记
- **信息窗口**：点击标记弹出详细信息卡片
- **3D 视图**：支持 3D 俯视模式，更加直观
- **地图工具**：内置比例尺和工具条
- **响应式设计**：在桌面和移动设备上都能良好显示
- **错误提示**：如果 API Key 未配置或地图加载失败，会显示友好的错误提示
- **智能视野**：自动计算最佳中心点和缩放级别

## 常见问题

### Q: 为什么地图显示"请在设置中配置高德地图 API Key"？
A: 需要先申请并配置高德地图 API Key，参考上面的步骤 1 和 2。

### Q: API Key 是否收费？
A: 个人开发者可以免费使用，每日配额 30 万次，足够一般应用使用。

### Q: 什么是安全密钥？是否必须配置？
A: 安全密钥（securityJsCode）是高德提供的额外安全机制，**不是必须的**。如果您的应用需要更高的安全性，可以在高德控制台申请并配置。一般应用只配置 API Key 即可。

### Q: 地图加载失败怎么办？
A: 请检查：
   - 是否已运行 `npm install @amap/amap-jsapi-loader`
   - API Key 是否正确配置（Web 端 JS API 类型）
   - 网络连接是否正常
   - 浏览器控制台是否有错误信息
   - API Key 的使用配额是否用完

### Q: 为什么有的终端不在地图上显示？
A: 地图只显示满足以下条件的终端：
   - 状态为**在线**（online）
   - 有有效的 **GPS 数据**

### Q: 地图可以进行哪些操作？
A: 支持以下操作：
   - 鼠标拖动地图
   - 滚轮缩放
   - 双击放大
   - 点击标记查看详细信息
   - 使用工具条进行缩放和其他操作

## 技术细节

- **地图引擎**：高德地图 JS API 2.0
- **加载方式**：使用 `@amap/amap-jsapi-loader` 按需动态加载
- **坐标系统**：使用国测局坐标系（GCJ-02）
- **视图模式**：3D 视角模式
- **默认中心点**：北京（116.397428, 39.90923）
- **插件支持**：比例尺（AMap.Scale）、工具条（AMap.ToolBar）
- **视野计算**：单个终端时缩放到级别 14，多个终端时自动计算最佳视野
- **内存管理**：组件卸载时自动销毁地图实例，防止内存泄漏
